@using System.Globalization;
@using CBBW.BOL.Tour;
@model IEnumerable<TourRuleListData>
@{
    ViewBag.Title = "Tour Rules";
    //Layout = "~/Areas/Security/Views/Shared/_Layout.cshtml";
}



<div class="row newTable">
    <div class="col-md-12">



        <div class="heading_text_btn mb-3 mt-4">
            <div class="leftButton">
                <button type="submit" class="btn btn-primary"
                        onclick="window.location.href = '@Url.Action("CreateRule","TourRule",new {area ="security" })';">
                    <i data-feather="plus-circle"></i>
                    Add
                </button>
            </div>
            <h2>Tour - RULES</h2>

        </div>
    </div>
    <div class="col-md-12">
        <div class="table-responsive">
            <table id="tblRules" class="table table-bordered btnalign mt-4">
                <thead>
                    <tr>
                        <th scope="col">SL.No.</th>
                        <th scope="col">Entry Date</th>
                        <th scope="col">Effective From Date</th>
                        <th style="background-color: pink; color: black; border: none; text-align: center;" scope="col">Actions</th>
                    </tr>
                </thead>
                <thead>
                    <tr>
                        <th scope="col">&nbsp;</th>
                        <th scope="col">
                            <div class="form-group">
                                <input type="text" class="form-control tblSearch" placeholder="Search...">
                            </div>
                        </th>
                        <th scope="col">
                            <div class="form-group">
                                <input type="text" class="form-control tblSearch" placeholder="Search...">
                            </div>
                        </th>
                        <th scope="col" style="background-color: pink; color: black; border: none; text-align: center;">&nbsp;</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null)
                    {
                        foreach (var item in Model)
                        {
                            <tr>
                                <th scope="row">@item.SL</th>
                                <td>@item.EntryDateDisplay</td>
                                <td>@item.EffectiveDateDisplay</td>
                                <td></td>
                            </tr>
                        }
                    }

                </tbody>
            </table>
        </div>
    </div>
</div>
@section scripts{   

    <script>
        $(document).ready(function () {
            var dtinstance = $('#tblRules').DataTable({
                columns: [
                    { 'data': 'SL' },
                    { 'data': 'EntryDateDisplay' },
                    { 'data': 'EffectiveDateDisplay', 'searchable': true, },
                    {
                        'data': 'IsApplied', render: function (data, type, row, meta) {
                            //var viewBtn = '<button type="button" class="btn primaryLink" data-toggle="tooltip" data-placement="top"> <i data-feather="eye"></i></button>';
                            var viewBtn = '<button type="button" id="' + row.EntryDateDisplay + '" data-dt="' + row.EffectiveDateDisplay + '" data-btn="V" onclick="FnViewNote(this)" class="btn primaryLink" data-toggle="tooltip" data-placement="top" title="Details"> <svg xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round class="feather feather-eye"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx=12 cy=12 r=3></circle></svg></button>';
                            var deleteBtn = '<button type="button" id="' + row.EntryDateDisplay + '" data-dt="' + row.EffectiveDateDisplay + '" data-btn="D" onclick="FnViewNote(this)" class="btn secondaryLink" data-toggle="tooltip" data-placement="top" title="Remove" data-placement="top" title="" data-bs-original-title="Pending"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg></button>';
                            var mbtns = '<span class="actionBtn d-block">';
                            mbtns = mbtns + viewBtn;
                            if (!row.IsApplied) { mbtns = mbtns + deleteBtn; }
                            mbtns = mbtns + '</span>';
                            return type === 'display' ? mbtns : data;
                        }
                    },
                ],
                bServerSide: true,
                sAjaxSource: '/Security/TourRule/getListOfRules',
                "pagingType": "input",
            });            
            $('.tblSearch').on('keyup change', function () {
                dtinstance.search(this.value).draw();
            });         
            $('.tblSearch').on('click', function (e) {
                e.stopPropagation();
            });
        });
        function FnViewNote(ctrl) {
            var entrydate = $(ctrl).attr('id');
            var effectivedate = $(ctrl).attr('data-dt');
            var btnType = $(ctrl).attr('data-btn');
            var destinationurl = '/Security/TourRule/ViewRuleV2?EffectiveDate=' + effectivedate +'&isFromIndex=true' ;
            if (btnType == 'D') { destinationurl = destinationurl + '&isDelete=true'; }
            window.location.href = destinationurl;
        };
    </script>
}
<script src="~/UIContent/JS/jquery-3.6.0.min.js"></script>
<script>
        //$(document).ready(function () {
        //    var tbl = $('#tblRules').DataTable();
        //    var filter1 = $('#filterentrDate');

        //    var filter2 = $('#filterEffDate');
        //    filter1.on('keyup change', function () {
        //        tbl.columns(1).search(this.value).draw();

        //    });
        //    filter2.on('keyup change', function () {
        //        tbl.columns(2).search(this.value).draw();

        //    });

        //});
</script>